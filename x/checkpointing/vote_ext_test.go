package checkpointing_test

import (
	"encoding/hex"
	"fmt"
	"github.com/babylonchain/babylon/x/checkpointing"
	"math/rand"
	"testing"

	"github.com/stretchr/testify/require"

	"github.com/babylonchain/babylon/testutil/datagen"
	testhelper "github.com/babylonchain/babylon/testutil/helper"
	"github.com/babylonchain/babylon/x/checkpointing/types"
)

func TestVoteExtension(t *testing.T) {
	myData := "0ab1010a4608d00112001a0da9f3947201000000000000000022308d9ded6b6dee78f05682eb4d9f21b19e0e54fc0e35c2471a59f896191b7bea6ad3f8eb2bc811960278a673ddf7f414a410011a60a905d127c63a63599d8297cdb00302841e3639d7cfcb9ab52fedc9894d21ac3d1dc49fe48242c8f89c803906df5f4ad60f84438c38cf610c6b3b5f56d48a36cbbcd2323ef440bf06d657614ff61826f0a73682e2ca7f0dfa45f8684161296c1120c48fef4512834612610a1b0a14913588cc13010bf14c34152c12fc57ff84a1d4421881be93072240c6c486174e9f972e0d89f81b1d6ceb36c906aa7583cff6f77963a16015a7b831ea0eaafc3b241a794843b8dbb54c126962a5ae0aa1d9da49d0ba99a2f2f8c60b280212a5020a1b0a14f3baff7c6ddad8b66da9bb2e4697c5c3bfc514411880bfd6061ac1010a3162626e76616c6f7065723174646438657666636e30356e376d6870667a6a64666d647a6a6d3565683465356c7232746630123162626e76616c6f7065723137776130376c72646d747674766d6466687668796439373963776c7532397a703376686b39301a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c301323095f767175b514128e37904434132839c380679b29cc346b5bec3353357e9cc3a6dccafeec5fff51ffac88bbfd87e1eb222403e3c21bcd7adb321807cea37245c7f311697151e8d429b6e22d6de1c5ba77ba0f8638026a719318927c7b2a00c367d63cf6ae1389ccccbfc4a11753faa914002280212a5020a1b0a14a7cefdeff7f89c18262b5f9f3df022e6aa69673718a0f8fa051ac1010a3162626e76616c6f70657231686168613073376c786c7a667a347061616368746773346a6d6e3539776535756e37306e6877123162626e76616c6f70657231356c38306d6d6c686c7a7770736633747437306e6d75707a753634786a6565687574336477341a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230874f9dd59c88f5b5c4102b797f52828bb925ef35198484155412df35e016d2159cd62e71d499c7154592f8038411691822404ab55650306cc8c886a691f6e206301e7e23b454925ed49b2f9491bd05ade7866f4aa44411326e5047422dbfa30b77b807fcc0fe79d248748e14abb442fd0b07280212a5020a1b0a144cc5d7aa161410db83244a3f2e8ec546664f053a18a09dcb031ac1010a3162626e76616c6f706572316c7930766163396c34747a78786132727832367166666e766d78666a347a3530777261376837123162626e76616c6f70657231666e7a613032736b7a7367646871657966676c6a61726b3967656e79377066366d65717364661a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230818ace8c24016d82eda0e0f7e46fb7c1cefcc04b7af0089e4a2107c3470aa23a2a20bdf578b2512dd0302b7f1307756b224080c3edab0b559b69aaa9fbeefad814f3ffbfa50aa66402031531996be1182f431c77bde3cd08222da28ee8cfd8f77326c918fa1621f33657a6c3f07dae6d190c280212a5020a1b0a14669964e20be90f625450ba8b59b6ae243603ae6d18c4e2c9031ac1010a3162626e76616c6f706572313575333835757478353373656c6c63347468796339346732373979617932676d637639636d33123162626e76616c6f706572317636766b666373746179386b79347a73683239346e64347779736d7138746e64656b657966661a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c30132308813361dd2857c0c027a53df0d69de5592645aedf57339e058f3d4f7039ea0890dd436f23234de1f25007338318c8ae42240e0439a6ebcc083b18e3c25c1a606a4ff94d30dd404a56e858d82f24e060e9c25893840a6e60ced52aa89e7fcbade9e0089992d4dae6710ee5df155edad6e8f0f280212610a1b0a1401458b61f0d7de6e90798fe8c370413d718eb34c18e0e1c9032240f3b166c1fde21284c80da687782c95070a5b7634f95c8abe18349718a8864bbb37b8fbb6f2a120efa3bd00aa03c49b36b840340bff00630959d04336ce18d907280212610a1b0a1402d13b7b5962425e40a637b5ee36ff3e16f0edb018e0e1c9032240695a7f47b4f524da0579d5504e5d724f22452c0e32c0a05b2c95b43849f090fb96109fd0e9ee2be3daf0bd3822e8711cf615e717aa63517974ab6e64e2c21e05280212a5020a1b0a14035f29deccc727323d3747ec0837a89b9b14f19818e0e1c9031ac1010a3162626e76616c6f706572313079786571786d39756e77717663616d333039633832736d686d647870633779747235397471123162626e76616c6f706572317164306a6e686b7663756e6e79306668676c6b71736461676e7764336675766375336c6d656c1a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230a579779f356e6573583b5513258402314db8625598327eaab0cc47b1d66c1f377ccb5bd42cdd4afbc08e865b3c9cbf00224075f378634cb8848fbf36d111eeab67f3f3396113a6f89451da4db5bf3b19033cce739adf598219a9cbd8f395af7798e95027450d1bc3589977c2b8198c83c702280212a5020a1b0a140f27894c5a0f9f166cad4aa4d0ba959ed7439c3918e0e1c9031ac1010a3162626e76616c6f706572317139617034393435397767736a6a673479367070703971337778636c6c336d77326372676778123162626e76616c6f7065723170756e636a6e7a3670373033766d396466326a64707735346e6d7435383870657365717935781a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c301323096f57dccf3278a80e1a9e98382dbbb33d288680004eba45d44e34d0ad0b14c0c06deebe72814c0abfdb77f15eae0cfce22405dd5e3d2d268d7ba90a974139fa0d469efdf4b4525f4404229fa7628295bef70cc0f1f5dc69e6c9d0117973ba7913c8e27f89324e5dfb09e6d55e74a40e5b40a280212a5020a1b0a1410c9cb2775c3d529338f64e480a185c47b221a4718e0e1c9031ac1010a3162626e76616c6f70657231646b797364666d6b6a74376b726637346d78346b6c3278786d30666e6e33357678366e726e73123162626e76616c6f706572317a7279756b666d346330326a6a767530766e6a67706776396333616a79786a3870756175336e1a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230b7c4570a45cb560e58d3a7c484d53b96bb6ce4e15261c42982d62ac1659bb8b18505537f64b857c572ed525e04da3d7d22406dbbec997a9023496c1e425f48063fe4d37d46049680b07e69fe522e2f9fa686d6d8c69be855d9685c6453d9178900fd6e4c52a8ea069afee3d976ebf6d48e0a280212a5020a1b0a1414978b7193b9c70c6c3146de67bd2733e155eb1618e0e1c9031ac1010a3162626e76616c6f706572316e61377067346c383935326a73637a687833666378323237377a796533653872727a7979756b123162626e76616c6f706572317a6a74636b75766e68387273636d7033676d307830306638783073347436636b6474613375361a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c301323095de908cd930a32a3f592ceb419042b40d293f87b6b882983e766def678f57ef45adb29b0b03dcf0f4ed5e167249d49d22401ee2293c8f9ea8ff6cdcb6acfd00487d0f904e4c3f5d8751c53d46ed445d91c64733afd112a6388315791c7f2a7edd9e947c160f0f7a2e033124cee300899a08280212a5020a1b0a141e67e744bcd9b8d5b3487ca7102c13204d95c55318e0e1c9031ac1010a3162626e76616c6f70657231726c726a6c6d3672656336686c6e767a616b796a333964356676377037766773336b71343732123162626e76616c6f7065723172656e37773339756d78756474763667306a6e337174716e797078657433326e7963713532611a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230b1cfbbce2dc50a19246b75bdd8bd6453e73c859c6f629ce4517a2af040aab6bba7cc699dce3154a064c68e5acf96c4f8224084a4c157fbf67ccb86927e9b2cdc8cc3561fc77f39cfce26bdf5252dbf730afc68fbf521fc06d817aad0f9aa50798e97aad34fbe16894a3c05f46692704ee80b280212a5020a1b0a1427c71cb09dce2559af7b5485c4db830b0cc69d9f18e0e1c9031ac1010a3162626e76616c6f706572313075753636333566643678706477786730396364666665727679613264753836673333377037123162626e76616c6f70657231796c72336576796165636a346e746d6d326a7a75666b7572707678766438766c6861763367791a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230aa12dd24c1686b84f42761044d302a2859ed98f8b384bb76448781e1e2612e2fb208a913a8b36bbae40fca69513bc8952240ef41809c551a9e66adcb5a9570da3c8250ce222a391ceec00f7c3fc3b6adf8434b88b37cbdc251cca1eaec002f4123ed61a25675f469461c5579f6d3fd4a4401280212a5020a1b0a142ae7c766652583a1cf1ad052e170310966196d8c18e0e1c9031ac1010a3162626e76616c6f706572316164663039343063327364766c796d3468307a64307332667964726b766639683766666c7968123162626e76616c6f7065723139746e7577656e39796b7036726e6336367066777a75703370396e706a6d76767767743532731a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230b5a3387bdfff2d33b4988b23fc3af9c45990941e8ee99496314a637157a1d72381159f6cdc3ef02498d74e9fb2ded7712240145e6d53c7ac95824f9da4356513ab462b2fc8e590207bc01083fc0194a30af1eca87bd0b3a393d21989b146032eb8e41fb559cd916327aa391515b56c13630e280212a5020a1b0a1456841e178813a3cb016e4793e602e36f4af515a018e0e1c9031ac1010a3162626e76616c6f706572313068673577616575786838793077687a6132766d386c757a3933616b393371756d6871687a34123162626e76616c6f7065723132367a70753975677a7733756b717477673766377671687264613930323964716172787678731a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c301323088c5b82e89c830b83b919f259f615547c4d8a8b49a31175cf3578ec1504cd5f6d1c711a6b71d483f1367c872d286f7e4224010c0d6e7f3dfea5c84d45bc9f33a17d6a39191df7d85e6e16590e800b4ea280362dddb8c450a041ad4f92bd30361d139635dde0f519ea420981ac866c17d130b280212a5020a1b0a145d93c82425d8e7fc05ca46952ab40811a85f2f2b18e0e1c9031ac1010a3162626e76616c6f706572316766666b63377579746635327a73737167637879657839373833683578673671686e37307730123162626e76616c6f70657231746b6675736670396d726e6c637077326736326a346471677a783539377465743668353871361a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230b286f3ab7f1e15307133d8a03f3ca968158a1d31b06d81487389990742d14aa478f6445422ee38b913a9a2a5e2a8273b2240b25a80fd0933244c73b4071b7c79d5d414c5695e718dd169ace0137d590f3feb0c616b401cb360bfd970bab197d8143d85ec2ade3bed667f50a41445e9dde00c280212a5020a1b0a146d7fe39fe53d2fac9779640d5a3b36c96f4a503818e0e1c9031ac1010a3162626e76616c6f706572316e326d346a6c777a7a70337832713063676878663566676a34357577746a6a6a6c74367a3330123162626e76616c6f7065723164346c3738386c393835683665396d65767378343577656b65396835353570636b6a326d76771a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230b3b7205d4d21077cb0a76e45b71083f6a0dbfb69fb75ade1ea99c33b9d0c5c777883d189f4535d351203264a91b286032240d63e0684589abc171db5643e22bf2307ee9b6a0c3975e0b9d1aaa84e5fe48559db4dcf4b54b4c3fe84b03f7b67d089ce555b2707455c43b1cb29e80fc79f9d03280212a5020a1b0a1483b2377a35c6cc9bcd9c5527965e52d6e65f1a0a18e0e1c9031ac1010a3162626e76616c6f70657231366875336d717272306a68616678326c3533616c38726b367033643079636366667666307463123162626e76616c6f706572317377657277373334636d7866686e767532356e6576686a6a366d6e3937787332356d766879761a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c301323095487bce1f90be95132a98a20750a39269cf8db2e245cecd939a29fb16fa4ab90b8aa6f7adbaacdc0fe78695261727ee2240fa8b3d0142587b1db276ec4eee58fc9fb02ee051dcd2d12f6eaed8623d998b642e78c118ff63b51b1d194a0776346303787c222ac6632dce9dbe220923761908280212a5020a1b0a148d3bc6d13ce00956186a48a8ce17d34e4ba2d4c518e0e1c9031ac1010a3162626e76616c6f70657231326e76796c6c3438736c336a6c6c6e7a346e7537736770786d357a34747076306d3237647939123162626e76616c6f7065723133356175643566757571793476787232667a35767539376e6665393639347839347063726b611a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230a5a6a00c9f3ff9682611118a8a811f59353c4d9a77e1cf30839be57d151c2a3ddcfb62f8fc0d35c9bc3f1eb6b36768d02240047e309fef1197344e213d7e15233394d51e2f096deff3d6832f728899ac954756ecc94578438dad69bb0560d17d857a838ed3498d0096096ffa7ae84088620f280212a5020a1b0a14c4985b72f67675760ecc74d23140bd9bf18013f318e0e1c9031ac1010a3162626e76616c6f706572316763666b357538307a326c66686b73706d36757767783573646863686a616730346b77686b68123162626e76616c6f70657231636a76396b75686b7765366876726b76776e66727a7339616e30636371796c6e6177307871371a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230a22cca19b37dbf1f442f681ce501d03c4355736a32a8f980a89470fbd9415e063e910b2572999ab314e609f304c67e0a2240b8df6eb3f437f890427bf65d4bc79260575410414817d6f3ef683837f294144865a414dbaf0df3c508cb0fa2eaa24c4c34515a2906a94f8f6f028af244c01107280212a5020a1b0a14cadeb72cf139ccec9a8debd6519a16340b99785818e0e1c9031ac1010a3162626e76616c6f7065723137763577357565687034326879663270703735716b327a636c326a6675786c376366706e3934123162626e76616c6f7065723165743074777438333838787765783564613074397278736b787339656a377a636e386635736b1a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c30132308995c98a636b459441273141881a2344f73cd36d7d1268a7a1b0fe39f31cd09148ce1f7b2961ce876b8a26c413cd60e522403f56605950758c97391677f73d226adc78a09d3faba951bfeec32e1daaaab1459d282b7b1a20d8a1f02dc7193755040afeb8aed1528e261267002ba7ac608c01280212a5020a1b0a14cfb02dbacbcb798947fb89520e816470baa7d82118e0e1c9031ac1010a3162626e76616c6f70657231376e706d72616c6165377a716c377a656d306b7366747a7938643763636e71666b6d6a78746a123162626e76616c6f706572316537637a6d776b74656475636a336c6d3339667161717479777a6132306b7070656e3566786a1a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230b9b470b7f47947662992525244669cf6e3791053cd987b3df165b950c3edb2d56006c50d8e94fbd5804a64b9ceca2d202240ca4205c7a7b744fd23138c23b094837adfbed60941bb76b5feb5ee7bf149f0dfd89dbe52f7f6f338a2b6243a3851250583b18fb1951acb2c6ddec98b78f04f04280212a5020a1b0a14d6f25b1616005eebec2110f8ab8fdfdbecf878e718e0e1c9031ac1010a3162626e76616c6f7065723135646e6d707161793639616a71646c376e32776d71656b326d6d3265306b7a306c367133356a123162626e76616c6f70657231366d65396b39736b71703077686d70707a7275326872376c6d306b30733738386c79363365791a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230a8e9d622ad159daf16d47917c8862c1b46896277c75531f5839d6913938aeed47b1091cb5cb901e17a418d0a6ec47f772240f3bd64d6b539e9a8b13dca98c912f1aaf75321a11ac0c8fa68d19759e591ee15ba4b7a6f93af6ce117f56f9b2de7db66a16aaed053c148cb041c890e1390930a280212a5020a1b0a14dc0dcc137e963551e77c1d69234c562de5e6392118e0e1c9031ac1010a3162626e76616c6f706572316b79367a61783679396d7679687a79676572326461336c3779386d7834796d716c64746d3265123162626e76616c6f706572316d73787563796d376a63363472656d757234356a786e7a6b39686a3776776670767376376d301a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230af028bf3276e9969a36dcde9a50e4ec174c13054fa16b84db9d4a2397be45605095ade8292bf563c88d8169aab3967092240da8a49faaaeec7f4850ee7b0bf14dc94e68f470a04755259aa5475261ff13d339d161f591d02a2d5d8ac98dd9aa5a89a6609a8f1869dbf8e5c75f3603784dc09280212a5020a1b0a14f53c04833405993ab71592f3b8ea6f40e03b688318e0e1c9031ac1010a3162626e76616c6f706572316e6a71796638753535346c776668707778786e306b6179673239617667637772726a77726471123162626e76616c6f706572313735377166716535716b766e346463346a74656d33366e30677273726b3679723468776374761a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c301323096fbb987bde429dc1ebb59da496cc37f1f993c94a4a0c140c711d6956125833faae2899693e974feb358609c36174adc224076b0a63f301f3c5198fbad1235eb4f0ac436d5a7c7c33ddfe706caf1bdf561e92239eed6f9060d048ff18321ce1d60f5cbcf26237e4b1b010e80721841d20e0e280212a5020a1b0a147310ebbd10fd9e388789f67ed771769cecc6a2e418dfe1c9031ac1010a3162626e76616c6f70657231356a33703365323570793574376b74773037756370646439336d333735727937757861386b37123162626e76616c6f7065723177766777683067736c6b30723370756637656c647775746b6e6e6b7664676879346c307579631a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230923b4dbb06ac55e6edad91296aee24659b7d9a312248dc599c943eda5387e046c4507c4ba87c0037c533c535c3c6856722403cc4ef486e4978add7591d1088e472050845c718ed0e29db3f55c0f1fe3a5c4c3ab313af95d95889bcca33e5d2ae35d70699ba73756ac181996fbd3f88553f0a280212a4020a1a0a14592afda1e125850381d012d682f98c3a75b22ff418a0c21e1ac1010a3162626e76616c6f7065723170786866633965746730353638646636336e7474686368396173653663727838687979356134123162626e76616c6f70657231747934306d673070796b7a73387177737a747467393776763866366d79746c356677377a6c721a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c30132308a19df6946cf763783c332b1f2b2a5b4e0c49efca0d50a6877341d6ae1c0690c036a3e603afaeecee64fec1297b8c3732240177c61328707a03637fe2720307281f30af44a0c0aede686efe4cf3d319b7c2e0f173bb991342376317c02763a4c33d2c8dd3e20496922e6798539927c6a670a280212600a1a0a147b32267a2373c5c13bc5a3c58e704b4a505dd5c318a0c21e2240dfe33b4dc9da81bf839426d6b77696a37e612c82dc5a74b00a8c2e9dadffa64d34a04d87a6e9dab201cb9aab1b289437d0f2310ab1059cca6737a96273659708280212a2020a180a142a2b812cc49a3a987ab878f9715831860241fa26180a1ac1010a3162626e76616c6f7065723136707366796b7271706c6b70726e36776a30713832736a7a6d71736e32676c38616c36613066123162626e76616c6f70657231396734637a7478796e67616673373463307275687a6b703373637079723733783861766437681a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c301323085477155f336380713b96e32faae48c6ae19afb7bf43bc0a9729b8dbc68cebbcf5fa7aedc38c95e4cc8c8fe3ad25f5bd22407e4cc720071da0d29c9c23ebf8179c24bb4b892d2db17df0d891eed1e468b90163386982533edc1e8b01bb6fc203643db7d4547fb53481ff4a8d076e3886fd03280212a2020a180a142c12507341f7522646553297283a6e385e2818ae18011ac1010a3162626e76616c6f7065723165726b7973736c6a77353436736d33666c71356a78776e777363676c747a79656e6436726a66123162626e76616c6f7065723139736639717536703761667a76336a347832746a73776e773870307a737839776666676738331a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230a3d5bf28491b4cf24c7d4e641dd68e44a4746425d17ec18b649db101ff18cce17b13f3333c21c120ad5c14b790c78aa02240d62a3754c0a8732b1b6d8943465d93633b841a99fa46c5c0529dc6925b595d2525267cb996be24325a86cfaf5774f6a64854cabf67cfcbd795997d3c42366706280212a2020a180a1430260e88544c0c4b9b29efe2ae06c137ef64698818011ac1010a3162626e76616c6f70657231766e7673657163776a6177616b6c6a6573306a6739723465716774656d6c6576717865773273123162626e76616c6f7065723178716e71617a7a356673787968786566616c333275706b70786c686b673676677567343677651a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230ade322c12d05dad73e4b7e86676f40a8da92e15a84000fde94ff5d22d07d4510f9bdfc6c202c2428363f4c6b0dacbe642240fad895f44dee50436bba5abbf4b20c17f43436c93c0544a716a2ac7002a7f2a87a45760529779654d9f11212f8bad6a34f699aee66e8133a0da1774522496304280212a2020a180a14d4eae0c77f6fe3f0c8f6822a9aa42f4906e9a04218011ac1010a3162626e76616c6f706572316735326835333263683261766535613670726670717a36366677326667713774633476726333123162626e76616c6f70657231366e347770336d6c646c336c706a386b7367346634667030667972776e677a7a6a3033366a301a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230a88718000f810efd8f3a779a8de37adc254eb938eeca71bdb8ae9420ec2920e7510d352493f345baec7ed62c1759eb5e2240edd39e1a9837282a3a61bd9cf096138b5d1b5a27437412614724c450c30353bf3d37c23f1fa5f2667925bcf0684687ea7080aaeb5622de75389963d4f2d33b0a280212a2020a180a14e6057ea4401bba5e8518b1fef2c0b65bc2023db518011ac1010a3162626e76616c6f70657231767174386b3066326c717678676c793436727a32766e366b75686c3074366d7a636133307877123162626e76616c6f7065723175637a6861667a7172776139617067636b386c303973396b74307071793064346138736168611a204f99143cd8d32a95b087e9f84fbc037e285b7ac5ff94feca3a5c107bb74006c120d0012880c3013230a9dc6caa12e3e0e386577f7ba81ebf002bcf9c4b399253512d390042b95aed32603995c233ecb9b09e731cce51dccd412240e0742c0728968df4c025d0281b2248711b0e93c17589bbd0c69c73f044ea2e422b380720e4c35721a3c27bae1071828a6c8fbdaa0b198747bdb2aa85708fce032802"
	veBytes, err := hex.DecodeString(myData)
	require.NoError(t, err)
	var injectedCkpt types.InjectedCheckpoint2
	err = injectedCkpt.Unmarshal(veBytes)
	require.NoError(t, err)
	votes := injectedCkpt.ExtendedCommitInfo.Votes
	bHash, err := checkpointing.FindLastBlockHash(votes)
	require.NoError(t, err)
	fmt.Println(bHash)
	/*
		for _, v := range votes {
			var ve types.VoteExtension
			err := ve.Unmarshal(v.VoteExtension)
			require.NoError(t, err)
			fmt.Println(ve)
			//require.Equal(t, 32, len(ve.BlockHash))
		}
		require.NoError(t, err)
	*/
}

// FuzzAddBLSSigVoteExtension_MultipleVals tests adding BLS signatures via VoteExtension
// with multiple validators
func FuzzAddBLSSigVoteExtension_MultipleVals(f *testing.F) {
	datagen.AddRandomSeedsToFuzzer(f, 4)

	f.Fuzz(func(t *testing.T, seed int64) {
		r := rand.New(rand.NewSource(seed))

		// generate the validator set with 10 validators as genesis
		genesisValSet, privSigner, err := datagen.GenesisValidatorSetWithPrivSigner(10)
		require.NoError(t, err)
		helper := testhelper.NewHelperWithValSet(t, genesisValSet, privSigner)
		ek := helper.App.EpochingKeeper
		ck := helper.App.CheckpointingKeeper

		epoch := ek.GetEpoch(helper.Ctx)
		require.Equal(t, uint64(1), epoch.EpochNumber)

		// go to block 11, ensure the checkpoint is finalized
		interval := ek.GetParams(helper.Ctx).EpochInterval
		for i := uint64(0); i < interval; i++ {
			_, err := helper.ApplyEmptyBlockWithVoteExtension(r)
			require.NoError(t, err)
		}

		epoch = ek.GetEpoch(helper.Ctx)
		require.Equal(t, uint64(2), epoch.EpochNumber)

		ckpt, err := ck.GetRawCheckpoint(helper.Ctx, epoch.EpochNumber-1)
		require.NoError(t, err)
		require.Equal(t, types.Sealed, ckpt.Status)
	})
}

// FuzzAddBLSSigVoteExtension_InsufficientVotingPower tests adding BLS signatures
// with insufficient voting power
func FuzzAddBLSSigVoteExtension_InsufficientVotingPower(f *testing.F) {
	datagen.AddRandomSeedsToFuzzer(f, 4)

	f.Fuzz(func(t *testing.T, seed int64) {
		r := rand.New(rand.NewSource(seed))
		// generate the validator set with 10 validators as genesis
		genesisValSet, privSigner, err := datagen.GenesisValidatorSetWithPrivSigner(10)
		require.NoError(t, err)
		helper := testhelper.NewHelperWithValSet(t, genesisValSet, privSigner)
		ek := helper.App.EpochingKeeper

		epoch := ek.GetEpoch(helper.Ctx)
		require.Equal(t, uint64(1), epoch.EpochNumber)

		// the number of validators is less than 2/3 if the total set
		numOfValidators := datagen.RandomInt(r, 5) + 1
		genesisValSet.Keys = genesisValSet.Keys[:numOfValidators]
		interval := ek.GetParams(helper.Ctx).EpochInterval
		for i := uint64(0); i < interval-1; i++ {
			_, err := helper.ApplyEmptyBlockWithValSet(r, genesisValSet)
			if i < interval-2 {
				require.NoError(t, err)
			} else {
				require.Error(t, err)
			}
		}
	})
}

// FuzzAddBLSSigVoteExtension_InvalidBLSSig tests adding BLS signatures
// with invalid BLS signature
func FuzzAddBLSSigVoteExtension_InvalidBLSSig(f *testing.F) {
	datagen.AddRandomSeedsToFuzzer(f, 4)

	f.Fuzz(func(t *testing.T, seed int64) {
		r := rand.New(rand.NewSource(seed))
		helper := testhelper.NewHelper(t)
		ek := helper.App.EpochingKeeper

		epoch := ek.GetEpoch(helper.Ctx)
		require.Equal(t, uint64(1), epoch.EpochNumber)

		interval := ek.GetParams(helper.Ctx).EpochInterval
		for i := uint64(0); i < interval-1; i++ {
			_, err := helper.ApplyEmptyBlockWithInvalidBLSSig(r)
			if i < interval-2 {
				require.NoError(t, err)
			} else {
				require.Error(t, err)
			}
		}
	})
}
